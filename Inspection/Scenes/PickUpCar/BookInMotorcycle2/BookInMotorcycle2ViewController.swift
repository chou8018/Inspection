//
//  BookInMotorcycle2ViewController.swift
//  Inspection
//
//  Created by Thanawat Pratumsat on 23/8/2564 BE.
//  Copyright (c) 2564 BE ___ORGANIZATIONNAME___. All rights reserved.
//
//  This file was generated by the Clean Swift Xcode Templates so
//  you can apply clean architecture to your iOS and Mac projects,
//  see http://clean-swift.com
//

import UIKit
import RadioGroup

protocol BookInMotorcycle2DisplayLogic: AnyObject
{
  func displaySomething(viewModel: BookInMotorcycle2.Something.ViewModel)
    func displayValidateMileNumber(viewModel: BookInMotorcycle2.Something.ViewModel)
    func displayKeyChecked(viewModel: BookInMotorcycle2.Something.ViewModel)
    func displayRemoteChecked(viewModel: BookInMotorcycle2.Something.ViewModel)
    func displayRemoteKeyChecked(viewModel: BookInMotorcycle2.Something.ViewModel)
    func displayImmobiliserKeyChecked(viewModel: BookInMotorcycle2.Something.ViewModel)
    
    
    func displayErrorGearBoxList(viewModel: BookInMotorcycle2.Something.ViewModel)
    func displayGearBoxList(viewModel: BookInMotorcycle2.Something.ViewModel)
    func displayGearBoxText(viewModel: BookInMotorcycle2.Something.ViewModel)
}

class BookInMotorcycle2ViewController: UIViewController, BookInMotorcycle2DisplayLogic
{
  var interactor: BookInMotorcycle2BusinessLogic?
  var router: (NSObjectProtocol & BookInMotorcycle2RoutingLogic & BookInMotorcycle2DataPassing)?

  // MARK: Object lifecycle
  
  override init(nibName nibNameOrNil: String?, bundle nibBundleOrNil: Bundle?)
  {
    super.init(nibName: nibNameOrNil, bundle: nibBundleOrNil)
    setup()
  }
  
  required init?(coder aDecoder: NSCoder)
  {
    super.init(coder: aDecoder)
    setup()
  }
  
  // MARK: Setup
  
  private func setup()
  {
    let viewController = self
    let interactor = BookInMotorcycle2Interactor()
    let presenter = BookInMotorcycle2Presenter()
    let router = BookInMotorcycle2Router()
    viewController.interactor = interactor
    viewController.router = router
    interactor.presenter = presenter
    presenter.viewController = viewController
    router.viewController = viewController
    router.dataStore = interactor
  }
  
  // MARK: Routing
  
  override func prepare(for segue: UIStoryboardSegue, sender: Any?)
  {
    if let scene = segue.identifier {
      let selector = NSSelectorFromString("routeTo\(scene)WithSegue:")
      if let router = router, router.responds(to: selector) {
        router.perform(selector, with: segue)
      }
    }
  }
  
  // MARK: View lifecycle
  
  override func viewDidLoad()
  {
    super.viewDidLoad()
    doSomething()
    setUpRadio()
    setUpTextField()
    setUpDropDown()
  }
  
  // MARK: Do something
  
    @IBOutlet weak var scrollView: UIScrollView!
    @IBOutlet weak var carConditionRadio: RadioGroup!
    @IBOutlet weak var milesRadio: RadioGroup!
    @IBOutlet weak var fuelDeliveryRadio: RadioGroup!
    @IBOutlet weak var engineConditionRadio: RadioGroup!
    @IBOutlet weak var gearConditionRadio: RadioGroup!
    @IBOutlet weak var breakConditionRadio: RadioGroup!
    
    @IBOutlet weak var milesTextFIeld: CustomTextField!
    
    @IBOutlet weak var noteMultilineTextField: MultilineTextField!
    
    @IBOutlet weak var handStartCheckBox: CheckBoxUIButton!
    @IBOutlet weak var kickStartCheckBox: CheckBoxUIButton!
    @IBOutlet weak var registrationPlateCheckBox: CheckBoxUIButton!
    
    @IBOutlet weak var keyCheckBox: CheckBoxUIButton!
    @IBOutlet weak var remoteKeyCheckBox: CheckBoxUIButton!
    @IBOutlet weak var remoteCheckBox: CheckBoxUIButton!
    @IBOutlet weak var immobilizarKeyCheckBox: CheckBoxUIButton!
    
    
    @IBOutlet weak var keyDropDown: DropDown!
    @IBOutlet weak var remoteDropDown: DropDown!
    @IBOutlet weak var remoteKeyDropDown: DropDown!
    @IBOutlet weak var immobilizarKeyDropDown: DropDown!
    
    
    @IBOutlet weak var gearboxDropDown: DropDown!
    @IBOutlet weak var gearboxLineView: UIView!
    @IBOutlet weak var gearboxLabel: UILabel!
    
    @IBOutlet weak var isInvalidMilesCheckBox: CheckBoxUIButton!
    @IBOutlet weak var reasonMileageTextField: CustomTextField!
    @IBOutlet weak var reasonMileageStackView: UIStackView!
    
  func doSomething()
  {
    let request = BookInMotorcycle2.Something.Request()
    interactor?.doSomething(request: request)
  }
  
  func displaySomething(viewModel: BookInMotorcycle2.Something.ViewModel)
  {
    //nameTextField.text = viewModel.name
  }
    
    
    //MARK: Radio
    func setUpRadio(){
      let attributedString = [NSAttributedString.Key.foregroundColor : UIColor.appPrimaryColor]
      
        carConditionRadio.attributedTitles = [
        NSAttributedString(string: "GOOD",
                           attributes: attributedString),
        NSAttributedString(string: "AVE",
                           attributes: attributedString),
        NSAttributedString(string: "FAIR",
                             attributes: attributedString),
        NSAttributedString(string: "POOR",
                             attributes: attributedString),
        NSAttributedString(string: "SCRAP",
                             attributes: attributedString)
      ]


        milesRadio.attributedTitles = [
            NSAttributedString(string: "‡∏Å‡∏¥‡πÇ‡∏•‡πÄ‡∏°‡∏ï‡∏£",
                               attributes: attributedString),
            NSAttributedString(string: "‡πÑ‡∏°‡∏•‡πå",
                               attributes: attributedString)
        ]
        
        fuelDeliveryRadio.attributedTitles = [
            NSAttributedString(string: "‡∏´‡∏±‡∏ß‡∏â‡∏µ‡∏î", attributes: attributedString),
            NSAttributedString(string: "‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏π‡πÄ‡∏£‡πÄ‡∏ï‡∏≠‡∏£‡πå", attributes: attributedString),
            NSAttributedString(string: "N/A", attributes: attributedString)
        ]
        
        engineConditionRadio.attributedTitles = [
            NSAttributedString(string: "‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏ï‡∏¥‡∏î", attributes: attributedString),
            NSAttributedString(string: "‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î", attributes: attributedString)
        ]
        gearConditionRadio.attributedTitles = [
            NSAttributedString(string: "‡∏û‡∏≠‡πÉ‡∏ä‡πâ", attributes: attributedString),
            NSAttributedString(string: "‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°", attributes: attributedString)
        ]
        breakConditionRadio.attributedTitles = [
            NSAttributedString(string: "‡∏û‡∏≠‡πÉ‡∏ä‡πâ", attributes: attributedString),
            NSAttributedString(string: "‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°", attributes: attributedString)
        ]
    }
    
    //MARK: condition
    @IBAction func conditionValueChange(_ sender: Any) {

        var redBookCondition : (String,String)  = ("","")
        switch carConditionRadio.selectedIndex {
        case 0:
            redBookCondition = ("G", "GOOD")
        case 1:
            redBookCondition = ("A", "AVE")
        case 2:
            redBookCondition = ("F", "FAIR")
        case 3:
            redBookCondition = ("P", "POOR")
        case 4:
            redBookCondition = ("Y", "SCRAP")
        
        default:
            return
        }
        print("üî∏ condition: \(redBookCondition.0) ,  value: \(redBookCondition.1)")
        DataController.shared.receiverCarModel.redBookCondition = redBookCondition.0
    }
    //MARK: miles
    @IBAction func milesValueChange(_ sender: Any) {
        var selectString:String? = nil
        switch milesRadio.selectedIndex {
        case 0:
            selectString = "‡∏Å‡∏¥‡πÇ‡∏•‡πÄ‡∏°‡∏ï‡∏£"
        case 1:
            selectString = "‡πÑ‡∏°‡∏•‡πå"
        default:
            return
        }
        print("üî∏ milesValue \(selectString)")
        
        DataController.shared.receiverCarModel.typeMiles = selectString
        let typeMilesId = milesRadio.selectedIndex + 1
        DataController.shared.receiverCarModel.mileageTypeId = typeMilesId
        
        /// set enable mileage
        isInvalidMilesCheckBox.check = false
        milesTextFIeld.setEnableView(isEnable: true)
        reasonMileageStackView.isHidden = true
        reasonMileageTextField.text = ""
        
        DataController.shared.receiverCarModel.invalidMileageReason = ""
        DataController.shared.receiverCarModel.isInvalidMileage = false
    }
    @IBAction func inInValidMileTapped(_ sender: Any) {
        isInvalidMilesCheckBox.toggle { [weak self] check in
            DataController.shared.receiverCarModel.isInvalidMileage = check
            self?.reasonMileageStackView.isHidden = !check
             
            if check {
                /// set miles = 0
                self?.milesTextFIeld.setEnableView(isEnable: false)
                self?.milesTextFIeld.text = ""
                self?.milesRadio.selectedIndex = -1
                
                DataController.shared.receiverCarModel.typeMiles = nil
                DataController.shared.receiverCarModel.mileageTypeId = 0
                DataController.shared.receiverCarModel.miles = ""
            }else{
                self?.reasonMileageTextField.text = ""
                self?.milesTextFIeld.setEnableView(isEnable: true)
                DataController.shared.receiverCarModel.invalidMileageReason = ""
            }
        }
    }
    
    
    //MARK: fuel delivery
    @IBAction func fuelDeliveryValueChanged(_ sender: Any) {
        var fuelDeliveryTuple : (String,String)  = ("","")
        switch fuelDeliveryRadio.selectedIndex {
        case 0:
            fuelDeliveryTuple = ("I","‡∏´‡∏±‡∏ß‡∏â‡∏µ‡∏î")
        case 1:
            fuelDeliveryTuple = ("N","‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏π‡πÄ‡∏£‡πÄ‡∏ï‡∏≠‡∏£‡πå")
        case 2:
            fuelDeliveryTuple = ("1","N/A")
        default:
            fuelDeliveryTuple = ("1","N/A")
        }
        print("üî∏ fuelDelivery: \(fuelDeliveryTuple.0) , value: \(fuelDeliveryTuple.1)")
        DataController.shared.receiverCarModel.fuelDeliveryName = fuelDeliveryTuple.1
        DataController.shared.receiverCarModel.fuelDelivery = fuelDeliveryTuple.0
        
        DataController.shared.inspectionCarModel.fuelDeliveryType = fuelDeliveryTuple.1
    }
    
    //MARK: engine condition
    @IBAction func engineConditionValueChanged(_ sender: Any) {
        var selectString:String? = nil
        switch engineConditionRadio.selectedIndex {
        case 0:
            selectString = "‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏ï‡∏¥‡∏î"
        case 1:
            selectString = "‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î"
        default:
            selectString = nil
        }
        print("üî∏ EngineCondition \(selectString)")
     
        DataController.shared.receiverCarModel.engineCondition = selectString
     
    }
    
    //MARK: gear condition
    @IBAction func gearConditionValueChanged(_ sender: Any) {
        var selectString:String? = nil
        switch gearConditionRadio.selectedIndex {
        case 0:
            selectString = "‡∏û‡∏≠‡πÉ‡∏ä‡πâ"
        case 1:
            selectString = "‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°"
        default:
            selectString = nil
        }
        print("üî∏ GearCondition \(selectString)")
     
        DataController.shared.receiverCarModel.gearCondition = selectString
    }
    
    //MARK: break condition
    @IBAction func breakConditionValueChanged(_ sender: Any) {
        var selectString:String? = nil
        switch breakConditionRadio.selectedIndex {
        case 0:
            selectString = "‡∏û‡∏≠‡πÉ‡∏ä‡πâ"
        case 1:
            selectString = "‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°"
        default:
            selectString = nil
        }
        print("üî∏ BreakCondition \(selectString)")
        
        DataController.shared.receiverCarModel.brakeCondition = selectString
     
    }
    
    //MARK: Keys
    @IBAction func keyTapped(_ sender: Any) {
        keyCheckBox.toggle { [weak self] check in
            if !check {
                DataController.shared.inspectionCarModel.isKey = false
                DataController.shared.receiverCarModel.removeKeys(type: "‡∏Å‡∏∏‡∏ç‡πÅ‡∏à")
                self?.keyDropDown.text = ""
                self?.uncheckKeys()
            }else{
                DataController.shared.receiverCarModel.isKeys = true
                DataController.shared.receiverCarModel.addKeys(type: "‡∏Å‡∏∏‡∏ç‡πÅ‡∏à")
            }
        }
    }
    
    @IBAction func remoteKeyTapped(_ sender: Any) {
        remoteKeyCheckBox.toggle { [weak self] check in
            if !check {
                DataController.shared.inspectionCarModel.isRemoteKey = false
                DataController.shared.receiverCarModel.removeKeys(type: "‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡∏£‡∏µ‡πÇ‡∏°‡∏ó")
                self?.remoteKeyDropDown.text = ""
                self?.uncheckKeys()
            }else{
                DataController.shared.receiverCarModel.isKeys = true
                DataController.shared.receiverCarModel.addKeys(type: "‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡∏£‡∏µ‡πÇ‡∏°‡∏ó")
            }
        }
    }
    
    @IBAction func remoteTapped(_ sender: Any) {
        remoteCheckBox.toggle { [weak self] check in
            if !check {
                DataController.shared.inspectionCarModel.isRemote = false
                DataController.shared.receiverCarModel.removeKeys(type: "‡∏£‡∏µ‡πÇ‡∏°‡∏ó")
                self?.remoteDropDown.text = ""
                self?.uncheckKeys()
            }else{
                DataController.shared.receiverCarModel.isKeys = true
                DataController.shared.receiverCarModel.addKeys(type: "‡∏£‡∏µ‡πÇ‡∏°‡∏ó")
            }
        }
    }
    @IBAction func immobilizerKeyTapped(_ sender: Any) {
        immobilizarKeyCheckBox.toggle { [weak self] check in
            if !check {
                DataController.shared.inspectionCarModel.isImmobilizarKey = false
                DataController.shared.receiverCarModel.removeKeys(type: "‡∏Å‡∏∏‡∏ç‡πÅ‡∏à Immobilizer")
                self?.immobilizarKeyDropDown.text = ""
                self?.uncheckKeys()
            }else{
                DataController.shared.receiverCarModel.isKeys = true
                DataController.shared.receiverCarModel.addKeys(type: "‡∏Å‡∏∏‡∏ç‡πÅ‡∏à Immobilizer")
            }
            
        }
    }
    
    func uncheckKeys(){
        guard !keyCheckBox.check,
              !remoteKeyCheckBox.check,
              !remoteCheckBox.check,
              !immobilizarKeyCheckBox.check else { return }
        
        DataController.shared.receiverCarModel.isKeys = false
        DataController.shared.receiverCarModel.mapKeys = nil
    }
    
    //MARK: checkbox
    @IBAction func handStartTapped(_ sender: Any) {
        handStartCheckBox.toggle { check in
            DataController.shared.receiverCarModel.isHandStart = check
            DataController.shared.inspectionCarModel.isElectricStart = check
        }
    }
    @IBAction func kickStartTapped(_ sender: Any) {
        kickStartCheckBox.toggle { check in
            DataController.shared.receiverCarModel.isKickStart = check
            DataController.shared.inspectionCarModel.isPedelStart = check
        }
    }
    @IBAction func registrationPlateTapped(_ sender: Any) {
        registrationPlateCheckBox.toggle { check in
            DataController.shared.receiverCarModel.isRegistrationPlate = check
            DataController.shared.inspectionCarModel.isPlate = check
        }
    }
    
    func setUpTextField(){
        milesTextFIeld.autocorrectionType = .no
        noteMultilineTextField.autocorrectionType = .no
        reasonMileageTextField.autocorrectionType = .no
        
        noteMultilineTextField.delegate = self
        milesTextFIeld.delegate = self
        reasonMileageTextField.delegate = self
        
        addTarget(from: milesTextFIeld)
        addTarget(from: reasonMileageTextField)
    }
    
    fileprivate func addTarget(from textfield: UITextField ){
        textfield.addTarget(self, action: #selector(textFieldDidChange(_:)),for: .editingChanged)
    }
    
    //MARK: Dropdown
    func setUpDropDown(){
        let keyValue = ["1","2","3","4","5","6","7","8","9","10"]
        keyDropDown.optionArray = keyValue
        keyDropDown.didSelect { [weak self] (selected, _, _) in
            
            DataController.shared.receiverCarModel.isKeys = true
            DataController.shared.receiverCarModel.addKeys(type: "‡∏Å‡∏∏‡∏ç‡πÅ‡∏à", amount: selected)
            DataController.shared.inspectionCarModel.isKey = true
            
            self?.keyDropDown.text = selected
            
            let request = BookInMotorcycle2.Something.Request(keyCheck : selected)
            self?.interactor?.keyCheck(request: request)
        }
        remoteDropDown.optionArray = keyValue
        remoteDropDown.didSelect { [weak self] (selected, _, _) in
            

            DataController.shared.receiverCarModel.isKeys = true
            DataController.shared.receiverCarModel.addKeys(type: "‡∏£‡∏µ‡πÇ‡∏°‡∏ó", amount: selected)
            DataController.shared.inspectionCarModel.isRemote = true
            
            self?.remoteDropDown.text = selected
            
            let request = BookInMotorcycle2.Something.Request(remoteCheck : selected)
            self?.interactor?.remoteCheck(request: request)
        }
        
        remoteKeyDropDown.optionArray = keyValue
        remoteKeyDropDown.didSelect { [weak self] (selected, _, _) in
            
            DataController.shared.receiverCarModel.isKeys = true
            DataController.shared.receiverCarModel.addKeys(type: "‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡∏£‡∏µ‡πÇ‡∏°‡∏ó", amount: selected)
            DataController.shared.inspectionCarModel.isRemoteKey = true
            
            self?.remoteKeyDropDown.text = selected
            
            let request = BookInMotorcycle2.Something.Request(remoteKeyCheck : selected)
            self?.interactor?.remoteKeyCheck(request: request)
        }
        
        
        immobilizarKeyDropDown.optionArray = keyValue
        immobilizarKeyDropDown.didSelect { [weak self] (selected, _, _) in
            
            DataController.shared.receiverCarModel.isKeys = true
            DataController.shared.receiverCarModel.addKeys(type: "‡∏Å‡∏∏‡∏ç‡πÅ‡∏à Immobilizer", amount: selected)
            DataController.shared.inspectionCarModel.isImmobilizarKey = true
            
            self?.immobilizarKeyDropDown.text = selected
            
            let request = BookInMotorcycle2.Something.Request(immobilizerKeyCheck : selected)
            self?.interactor?.immobilizerKeyCheck(request: request)
        }
    }
    
    //MARK: Presenter
    func displayValidateMileNumber(viewModel: BookInMotorcycle2.Something.ViewModel) {
        milesTextFIeld.text = viewModel.validateMilesNumber
        
        DataController.shared.receiverCarModel.miles = viewModel.validateMilesNumber
    }
    
    func displayKeyChecked(viewModel: BookInMotorcycle2.Something.ViewModel) {
        keyCheckBox.check = viewModel.isKeyCheck ?? false
    }
    func displayRemoteChecked(viewModel: BookInMotorcycle2.Something.ViewModel) {
        remoteCheckBox.check = viewModel.isRemoteCheck ?? false
    }
    func displayRemoteKeyChecked(viewModel: BookInMotorcycle2.Something.ViewModel) {
        remoteKeyCheckBox.check = viewModel.isRemoteKeyCheck ?? false
    }
    
    func displayImmobiliserKeyChecked(viewModel: BookInMotorcycle2.Something.ViewModel) {
        immobilizarKeyCheckBox.check = viewModel.isImmobilizerKeyCheck ?? false
    }
    
    
    //MARK: fetch GearBox
    var isGearBox = false
    
    func fetchGearBox(){
        interactor?.fetchGearBox(request: BookInMotorcycle2.Something.Request())
    }
    func displayErrorGearBoxList(viewModel: BookInMotorcycle2.Something.ViewModel) {
        guard let errorMessage = viewModel.errorMessage else { return }
        alertErrorMessageOKAction(message: errorMessage) {
            //ignhred
        }
    }
    
    func displayGearBoxList(viewModel: BookInMotorcycle2.Something.ViewModel) {
        guard let gearBoxList_bu = viewModel.gearBoxList_bu else { return }
        isGearBox = true
        
        setValue(to: gearboxDropDown, values: gearBoxList_bu) { [weak self] (selectValue, _, _) in
            self?.gearboxDropDown.text = selectValue
            
            let request = BookInMotorcycle2.Something.Request(selectGearbox: selectValue)
            self?.interactor?.selectGearBox(request: request)
            
            self?.gearboxLabel.validateLabel(true)
            self?.gearboxLineView.validateLineView(true)
        }
        
        self.prepareGearBox()
    }
    
    func displayGearBoxText(viewModel: BookInMotorcycle2.Something.ViewModel) {
        gearboxDropDown.text = viewModel.gearBox_BU
        
    }
    
    func setValue(to textfield:DropDown , values: [String], didSelected:@escaping (_ selectedText: String, _ index: Int , _ id:Int )->() ){
        textfield.text = ""
        textfield.optionArray = values
        textfield.didSelect(completion: didSelected)
    }
    
    func fetchAPI(){
        if !isGearBox {
            fetchGearBox()
        }
    }
    
    func prepareGearBox(){
        let request = BookInMotorcycle2.Something.Request(codeGearBox: DataController.shared.receiverCarModel.gearbox)
        interactor?.prepareGearBox(request: request)
    }
    
    
    
    func prepareData(){
        let model = DataController.shared.receiverCarModel
        let typeMilesValue = ["‡∏Å‡∏¥‡πÇ‡∏•‡πÄ‡∏°‡∏ï‡∏£", "‡πÑ‡∏°‡∏•‡πå"]
        let redBookValue = ["G", "A", "F", "P", "Y"]
        
        
        carConditionRadio.selectedIndex = getRadioIndexByValue(from: redBookValue, value: model.redBookCondition)
        
        milesTextFIeld.text = model.miles
        milesRadio.selectedIndex = getRadioIndexByValue(from: typeMilesValue, value: model.typeMiles)
        ///key
        let numberOfKey = model.mapKeys?["‡∏Å‡∏∏‡∏ç‡πÅ‡∏à"] as? String
        let numberOfKeyRemote = model.mapKeys?["‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡∏£‡∏µ‡πÇ‡∏°‡∏ó"] as? String
        let numberOfRemote = model.mapKeys?["‡∏£‡∏µ‡πÇ‡∏°‡∏ó"] as? String
        let numberOfImmobilizer = model.mapKeys?["‡∏Å‡∏∏‡∏ç‡πÅ‡∏à Immobilizer"] as? String
        let numberOfKeyless = model.mapKeys?["‡∏Å‡∏∏‡∏ç‡πÅ‡∏à Keyless"] as? String
        
        let checkKey = (numberOfKey?.toInt() ?? 0) > 0
        let checkRemote = (numberOfRemote?.toInt() ?? 0) > 0
        let checkKeyRemote = (numberOfKeyRemote?.toInt() ?? 0) > 0
        let checkImmobilizer = (numberOfImmobilizer?.toInt() ?? 0) > 0
        let checkKeyless = (numberOfKeyless?.toInt() ?? 0) > 0
        
        keyDropDown.text = checkKey ? numberOfKey : ""
        remoteDropDown.text = checkRemote ? numberOfRemote : ""
        remoteKeyDropDown.text = checkKeyRemote ? numberOfKeyRemote : ""
        immobilizarKeyDropDown.text = checkImmobilizer ? numberOfImmobilizer : ""
        
        
        keyCheckBox.check = checkKey
        remoteCheckBox.check = checkRemote
        remoteKeyCheckBox.check = checkKeyRemote
        immobilizarKeyCheckBox.check = checkImmobilizer
        
        
        fuelDeliveryRadio.selectedIndex = getRadioIndexByValue(from : ["‡∏´‡∏±‡∏ß‡∏â‡∏µ‡∏î", "‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏π‡πÄ‡∏£‡πÄ‡∏ï‡∏≠‡∏£‡πå", "N/A"], value: DataController.shared.receiverCarModel.fuelDeliveryName)
        
        isInvalidMilesCheckBox.check = (model.isInvalidMileage ?? false)
        reasonMileageStackView.isHidden = !(model.isInvalidMileage ?? false)
        reasonMileageTextField.text = model.invalidMileageReason
        
        let engineValue = ["‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏ï‡∏¥‡∏î" , "‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î"]
        let conditionValue = ["‡∏û‡∏≠‡πÉ‡∏ä‡πâ" , "‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°"]
        engineConditionRadio.selectedIndex = getRadioIndexByValue(from: engineValue, value: model.engineCondition)
        gearConditionRadio.selectedIndex = getRadioIndexByValue(from: conditionValue, value: model.gearCondition)
        breakConditionRadio.selectedIndex = getRadioIndexByValue(from: conditionValue, value: model.brakeCondition)
        
        handStartCheckBox.check = model.isHandStart ?? false
        kickStartCheckBox.check = model.isKickStart ?? false
        registrationPlateCheckBox.check = model.isRegistrationPlate ?? false
        
        noteMultilineTextField.text = model.annotation
    }
    
    @objc func updateView(){
        let model  = DataController.shared.receiverCarModel
    
        
        gearboxLabel.validateLabel(model.validGearBox)
        gearboxLineView.validateLineView(model.validGearBox)
        //------------------------------------------------------------//
    }
}


//MARK: keyboard
extension BookInMotorcycle2ViewController {
   override func viewWillAppear(_ animated: Bool) {
       super.viewWillAppear(animated)
       scrollView.registKeyboardNotification()
    
    prepareData()
    updateView()
    fetchAPI()

    NotificationCenter.default.addObserver(self, selector: #selector(updateView), name: NSNotification.Name("updateUI"), object: nil)
   }
   
   override func viewDidDisappear(_ animated: Bool) {
       super.viewDidDisappear(animated)
       scrollView.resignKeyboardNotification()
    
    NotificationCenter.default.removeObserver(self)
   }
}

extension BookInMotorcycle2ViewController : UITextViewDelegate {
    func textViewDidChange(_ textView: UITextView) {
        print("annotation : \(textView.text)")
        DataController.shared.receiverCarModel.annotation = textView.text
    }
}
extension BookInMotorcycle2ViewController : UITextFieldDelegate {
    func textFieldShouldReturn(_ textField: UITextField) -> Bool {
        textField.resignFirstResponder()
        return true
    }
}
extension  BookInMotorcycle2ViewController {
    @objc func textFieldDidChange(_ textField: UITextField) {
        //
        switch textField {
        case milesTextFIeld:
            print("miles : \(textField.text)")
            let request = BookInMotorcycle2.Something.Request(miles: textField.text)
            interactor?.validateMileNumber(request: request)
        
        case reasonMileageTextField:
            DataController.shared.receiverCarModel.invalidMileageReason = textField.text
        default:
            break
        }
    }
    
}
